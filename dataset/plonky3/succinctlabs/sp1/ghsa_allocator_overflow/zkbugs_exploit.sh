#!/bin/bash
# Run unit tests to demonstrate the vulnerability

set -e

echo "=========================================="
echo "Running Unit Tests"
echo "=========================================="
echo ""

TESTS_DIR="tests"
OUTPUT_BINARY="$TESTS_DIR/test_runner"

if [ ! -f "$OUTPUT_BINARY" ]; then
    echo "❌ Unit test binary not found: $OUTPUT_BINARY"
    echo "   Run ./zkbugs_compile_setup.sh first"
    exit 1
fi

echo "Executing tests..."
cd "$TESTS_DIR"
./test_runner --test-threads=1

TEST_STATUS=$?

cd ..
echo ""
if [ $TEST_STATUS -eq 0 ]; then
    echo "✓ All tests passed!"
else
    echo "❌ Some tests failed (exit code: $TEST_STATUS)"
fi

# Cleanup
rm -f "$OUTPUT_BINARY"
echo "Cleaned up test artifacts"

echo ""
exit $TEST_STATUS
