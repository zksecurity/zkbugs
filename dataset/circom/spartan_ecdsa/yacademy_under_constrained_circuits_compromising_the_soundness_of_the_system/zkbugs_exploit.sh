#!/bin/bash
source zkbugs_vars.sh

# Run the following scripts
./zkbugs_clean.sh
./zkbugs_compile_setup.sh
./zkbugs_positive_test.sh

# Copy extra circom runtime scripts to convert JSON to wtns
echo "Copy extra circom runtime scripts to convert JSON to wtns"
cp ${CIRCOM_RUNTIME}/* $CIRCUITJS

# Replace the witness
echo "Replace the witness"
node $CIRCUITJS/export_witness.js $CIRCUITWASM $EXPLOITABLE_WTNS $WTNS

# Print message for producing proof
echo "Producing proof"

# Run the command to produce the proof
snarkjs groth16 prove $ZKEY_FINAL $WTNS proof.json public.json

# Print message for verifying proof
echo "Verifying proof"

# Run the command to verify the proof
snarkjs groth16 verify $VKEY public.json proof.json

# Exit
exit 0
